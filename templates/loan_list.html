<!DOCTYPE html>
<html>
<head>
    <title>Loan List</title>
</head>
<body>
    <h1>Loan List</h1>
    <ul id="loanList"></ul>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        async function fetchLoans() {
            try {
                const response = await axios.get('/loans');
                const loans = response.data.loans;
                const loanList = document.getElementById('loanList');

                for (const loan of loans) {
                    const listItem = document.createElement('li');
                    const loanLink = document.createElement('a');

                    // Add error logging for invalid loan data
                    if (!loan.book_id || !loan.user_id) {
                        console.error('Invalid loan data:', loan);
                        continue; // Skip this loan and proceed with the next one
                    }

                    const [bookResponse, userResponse] = await Promise.all([
                        axios.get(`/books/${loan.book_id}`),
                        axios.get(`/users/${loan.user_id}`)
                    ]);

                    const book = bookResponse.data.book;
                    const user = userResponse.data.user;

                    // Convert the Unix timestamp to a JavaScript Date object
                    const loanDate = new Date(loan.loan_date * 1000);

                    loanLink.href = `/loans/${loan.id}`;
                    loanLink.textContent = `Book: ${book.title}, User: ${user.name}, Loan Date: ${loanDate}, Loan Length: ${loan.loan_length} days`;

                    listItem.appendChild(loanLink);
                    loanList.appendChild(listItem);
                }
            } catch (error) {
                console.error('Error fetching loans:', error);
            }
        }

        fetchLoans();
    </script>
</body>
</html>
